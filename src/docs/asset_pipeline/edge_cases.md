# Asset Generation 엣지 케이스 및 Known Issues

## 엣지 케이스

### 1. 오디오 생성 실패
**증상:** 일부 장면의 오디오만 생성됨

**원인:**
- TTS API 호출 실패
- 디스크 공간 부족
- 파일 권한 문제

**대응:**
- 재시도 로직 적용 (최대 2회)
- 파일 생성 확인
- 실패 시 명확한 에러 메시지

---

### 2. ComfyUI 서버가 실행되지 않은 경우
**증상:** `RuntimeError: ComfyUI 서버에 연결할 수 없습니다`

**원인:**
- ComfyUI 서버가 시작되지 않음
- 잘못된 URL 설정
- 네트워크 문제

**대응:**
- `check_health()`에서 명확한 에러 메시지 표시
- 헬스체크 실패 시 즉시 에러 발생

**해결 전략:**
- 사용자에게 ComfyUI 서버 실행 안내
- 서버 상태 확인 스크립트 제공 (향후)

---

### 3. 이미지 생성 타임아웃
**증상:** ComfyUI API 호출이 타임아웃됨

**원인:**
- 이미지 생성 시간이 너무 김
- 서버 부하
- 네트워크 지연

**대응:**
- 재시도 로직 적용 (최대 2회)
- 타임아웃 설정 확인

**해결 전략:**
- 타임아웃 시간 증가 고려
- 서버 리소스 모니터링

---

### 4. 모션 생성 비활성화 시
**증상:** 모션 프레임이 생성되지 않음

**원인:**
- `Config.MOTION_ENABLED = False`

**대응:**
- 노드가 자동으로 스킵됨
- 원본 `scenes` 그대로 반환

**참고:**
- 비활성화 시에도 `scenes` 구조는 유지됨
- 비디오 편집 시 정적 이미지 사용

---

### 5. 모션 프레임 생성 실패
**증상:** 일부 장면의 모션 프레임만 생성됨

**원인:**
- Wan2.2 I2V 모델 오류
- 이미지 업로드 실패
- 프레임 다운로드 실패

**대응:**
- 재시도 로직 적용 (최대 2회)
- 실패 시 에러 발생

**해결 전략:**
- 실패한 장면만 재생성하는 옵션 추가 (향후)
- 모션 생성 실패 시 정적 이미지로 폴백 (이미 구현됨)

---

### 6. 캐시된 파일이 삭제된 경우
**증상:** 캐시 히트가 되었지만 파일이 없음

**원인:**
- 사용자가 파일을 수동으로 삭제
- 디스크 오류
- 파일 시스템 문제

**대응:**
- 캐시 조회 시 파일 존재 확인
- 파일이 없으면 캐시 무효화 후 재생성

**구현:**
- `WorkflowCache.get_stage()`에서 파일 존재 여부 확인
- 파일이 없으면 `None` 반환하여 캐시 무효화

---

## Known Issues

### 1. 오디오와 이미지 생성의 병렬화 미지원
**문제:** 현재는 순차적으로 실행됨

**영향:** 전체 에셋 생성 시간이 길어짐

**해결 방안:**
- 오디오와 이미지 생성 병렬화 (향후)
- LangGraph의 병렬 노드 실행 기능 활용

---

### 2. 부분 에셋 재생성 메커니즘 없음
**문제:** 하나의 에셋 생성 실패 시 전체를 다시 생성해야 함

**영향:** 시간 낭비

**해결 방안:**
- 실패한 에셋만 재생성하는 옵션 추가 (향후)
- 캐시 시스템 개선

---

### 3. 에셋 품질 검증 없음
**문제:** 생성된 에셋의 품질을 검증하지 않음

**영향:** 저품질 에셋이 최종 비디오에 포함될 수 있음

**해결 방안:**
- 에셋 품질 검증 노드 추가 (향후)
- 품질 기준 설정 및 자동 재생성 로직

---

## 버그 이력

### 버그 #1: 이미지 프롬프트가 변경되지 않았던 문제
**날짜:** 2024-12 (추정)
**증상:** 각 장면의 이미지가 동일하게 생성됨

**원인:** 프롬프트 업데이트 로직 오류

**해결:**
- `update_prompt()` 함수 수정
- 프롬프트 변경 로직 개선

**상태:** 해결됨

---

### 버그 #2: 시드 랜덤화 누락
**날짜:** 2024-12 (추정)
**증상:** 동일한 프롬프트로 이미지를 생성해도 동일한 결과

**원인:** KSampler 노드의 시드가 고정되어 있었음

**해결:**
- `update_prompt()`에 시드 랜덤화 기능 추가
- 각 이미지 생성마다 랜덤 시드 사용

**상태:** 해결됨

